{"version":3,"file":"render.global.js","sources":["../src/shared/draw.ts","../src/utils/mergeCells.ts","../src/render/render.ts"],"sourcesContent":["import { fabric } from \"fabric\";\r\nimport { ILineOptions, IRectOptions } from \"fabric/fabric-impl\";\r\n\r\nexport type StaticCanvas = fabric.StaticCanvas;\r\nexport type Canvas = fabric.Canvas;\r\nexport type Group = fabric.Group;\r\nexport type Rect = fabric.Rect;\r\nexport type Line = fabric.Line;\r\nexport type Text = fabric.Text;\r\nexport type Textbox = fabric.Textbox;\r\n\r\n\r\nexport function createStaticCanvas(container): fabric.StaticCanvas {\r\n    return new fabric.StaticCanvas(container);\r\n}\r\n\r\nexport function createCanvas(container): fabric.Canvas {\r\n    return new fabric.Canvas(container);\r\n}\r\n\r\nexport function createGroup(objects?: fabric.Object[] | undefined, options?: fabric.IGroupOptions | undefined, isAlreadyGrouped?: boolean | undefined): fabric.Group {\r\n    return new fabric.Group(objects,options,isAlreadyGrouped);\r\n}\r\n\r\n\r\nexport function createRect(options:IRectOptions): fabric.Rect {\r\n    return new fabric.Rect(options);\r\n}\r\n\r\nexport function createLine(points?: number[], objObjects?: ILineOptions): fabric.Line {\r\n    return new fabric.Line(points, objObjects);\r\n}\r\n\r\nexport function createText(text: string, options: fabric.ITextOptions): fabric.Text {\r\n    return new fabric.Text(text, options);\r\n}\r\n\r\nexport function createTextbox(text: string, options: fabric.ITextOptions): fabric.Textbox {\r\n    return new fabric.Textbox(text, options);\r\n}","import { createGroup, createRect, createTextbox } from \"../shared\";\r\n\r\nexport function mergeCell(cell:MergeCell, cellWidth, cellHeight) {\r\n    const { startRow, startCol, endRow, endCol } = cell;\r\n    const left = startCol * cellWidth;\r\n    const top = startRow * cellHeight;\r\n    const width = (endCol - startCol + 1) * cellWidth;\r\n    const height = (endRow - startRow + 1) * cellHeight;\r\n\r\n    const rect = createRect({\r\n      left: left,\r\n      top: top,\r\n      width: width,\r\n      height: height,\r\n      fill: \"white\",\r\n      stroke: \"black\",\r\n      strokeWidth: 1,\r\n    });\r\n\r\n    const text = createTextbox(\"Hello\", {\r\n      left: rect.left,\r\n      top: rect.top,\r\n      width: rect.width,\r\n      height: rect.height,\r\n      fill: \"black\",\r\n      lockMovementX: true,\r\n      lockMovementY: true,\r\n    });\r\n    const group = createGroup([rect, text]);\r\n    return group;\r\n  }\r\n  type MergeCell = {\r\n    startRow: number;\r\n    startCol: number;\r\n    endRow: number;\r\n    endCol: number;\r\n  };","import { fabric } from \"fabric\";\r\nimport {\r\n  createStaticCanvas,\r\n  createCanvas,\r\n  createGroup,\r\n  createRect,\r\n  createLine,\r\n  createText,\r\n  createTextbox,\r\n} from \"../shared\";\r\n\r\nimport type {\r\n  StaticCanvas,\r\n  Canvas,\r\n  Group,\r\n  Rect,\r\n  Line,\r\n  Text,\r\n  Textbox,\r\n} from \"../shared\";\r\nimport { mergeCell } from \"../utils\";\r\n\r\nexport class Table {\r\n  private canvas: Canvas;\r\n  private cellWidth: number;\r\n  private cellHeight: number;\r\n  private row: number;\r\n  private col: number;\r\n  private cellLines: Line[] = [];\r\n  private mergeGroup: Group[] = [];\r\n  constructor(row: number, col: number, container: string) {\r\n    this.canvas = createCanvas(container);\r\n    this.cellWidth = 120;\r\n    this.cellHeight = 40;\r\n    this.row = row;\r\n    this.col = col;\r\n    this.canvas.selection = true;\r\n    // 监听 'selection:created' 和 'selection:updated' 事件\r\n    this.canvas.on(\"selection:created\", (e) => {\r\n      console.log(e);\r\n      \r\n      //@ts-ignore\r\n      e.target.set({ fill: \"#f00\" }); // 设置选中颜色\r\n      this.canvas.renderAll();\r\n    });\r\n\r\n    this.canvas.on(\"selection:updated\", (e) => {\r\n      console.log(e.target);\r\n      //@ts-ignore\r\n      e.target.set({ fill: \"#f00\" }); // 设置选中颜色\r\n      this.canvas.renderAll();\r\n    });\r\n\r\n    // 监听 'selection:cleared' 事件\r\n    this.canvas.on(\"selection:cleared\", (e) => {\r\n      //@ts-ignore\r\n      e.target.set({ fill: \"#fff\" }); // 设置未选中颜色\r\n      this.canvas.renderAll();\r\n    });\r\n  }\r\n\r\n  public initMaskTable() {\r\n    const totalHeight = this.row * this.cellHeight;\r\n    const totalWidth = this.col * this.cellWidth;\r\n    for (let i = 0; i <= this.row; i++) {\r\n      let horizontalLine = createLine(\r\n        [0, i * this.cellHeight, totalWidth, i * this.cellHeight],\r\n        {\r\n          stroke: \"black\",\r\n          strokeWidth: 1,\r\n        }\r\n      );\r\n      this.cellLines.push(horizontalLine);\r\n    }\r\n\r\n    for (let j = 0; j <= this.col; j++) {\r\n      var verticalLine = new fabric.Line(\r\n        [j * this.cellWidth, 0, j * this.cellWidth, totalHeight],\r\n        {\r\n          stroke: \"black\",\r\n          strokeWidth: 1,\r\n        }\r\n      );\r\n      this.cellLines.push(verticalLine);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public mergeCells(mergeCells: MergeCell[]): Table {\r\n    mergeCells.forEach((cell) => {\r\n      const group = mergeCell(cell, this.cellWidth, this.cellHeight);\r\n      this.mergeGroup.push(group);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  public render() {\r\n    this.canvas.add.apply(this.canvas, [...this.cellLines, ...this.mergeGroup]);\r\n    this.canvas.renderAll();\r\n  }\r\n}\r\n\r\ntype MergeCell = {\r\n  startRow: number;\r\n  startCol: number;\r\n  endRow: number;\r\n  endCol: number;\r\n};\r\n"],"names":["fabric"],"mappings":"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"}